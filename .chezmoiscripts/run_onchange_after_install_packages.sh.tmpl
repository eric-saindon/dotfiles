#!/usr/bin/env bash
# packages hash: {{ include "dot_config/mise/config.toml" | sha256sum }}
set -euo pipefail

# Resolve mise binary: prefer Homebrew on macOS, fallback to ~/.local/bin/mise
MiseBin=""
if command -v mise >/dev/null 2>&1; then
    MiseBin="$(command -v mise)"
elif [ -x "/opt/homebrew/bin/mise" ]; then
    MiseBin="/opt/homebrew/bin/mise"
elif [ -x "$HOME/.local/bin/mise" ]; then
    MiseBin="$HOME/.local/bin/mise"
else
    echo "Error: mise not found. Install via Homebrew: brew install mise" >&2
    exit 1
fi

# Trust the config and install tools
"$MiseBin" trust "$HOME/.config/mise/config.toml"
"$MiseBin" install
